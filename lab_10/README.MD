# iBGP





#### Цель:

Настроить iBGP в офисе Москва
Настроить iBGP в сети провайдера Триада
Организовать полную IP связанность всех сетей



#### Описание/Пошаговая инструкция выполнения домашнего задания:

В этой самостоятельной работе мы:

1. Настроим iBGP в офисе Москва между маршрутизаторами R14 и R15.
2. Настройм офис Москва так, чтобы приоритетным провайдером стал Ламас.
3. Настроим iBGP в провайдере Триада, с использованием RR.
4. Настройм офис С.-Петербург так, чтобы трафик до любого офиса распределялся по двум линкам одновременно.
5. Все сети в лабораторной работе должны иметь IP связность.





#### 1. Настроим iBGP в офисе Москва между маршрутизаторами R14 и R15.

Для этого пропишем на роутере R14 соседа в AS 1001 офиса Москва R15. Укажем чтобы next-hop менялся на наш, и взаимодействие осуществлялось с loopback - адреса:



![image](https://github.com/SalminKHV/OTUS/assets/130359715/42b1241f-11de-47c5-beb3-af4da2d75e3b)



Проделаем на роутере R15 тоже самое, и для выполнгения **ВТОРОГО ЗАДАНИЯ** сразу создадим префикс лист для отбора маршрутов из AS 301 и при помощи route-map увеличим показатель Local-Preference до 150,  чтобы все выходы в интернет с AS1001 осуществлялись через провайдера Ламас, и лишь в случае пропадания с ним прямого линка, выход в интеренет осуществлялся через провайдера Киторн. Для более быстрого перестроени сети назначим timer bgp 3 20:

![image](https://github.com/SalminKHV/OTUS/assets/130359715/203d8587-a9fb-4edb-9bdd-82a0660149c0)



В результате мы можем видеть, то на роутере R14 одни и теже сети доступны по двум путям, но приоритетным путем выбираются пути через роутер R15 c ip-адресом 100.1.0.15:

![image](https://github.com/SalminKHV/OTUS/assets/130359715/925f487d-2fd5-440e-9b4e-966c5d5d064c)



#### 3. Настроим iBGP в провайдере Триада, с использованием RR.

Для выпонения данного задания было принято решение объеденить R23 и R24 в кластер 5.20.0.1, а R25 и R26 в кластер 5.20.0.2, каждый роутер в своем кластере является роутером-рефлектором(сделано это для модуляции системы с большим количеством промежуточных роутеров в одной AS и для опыта с применением такой технологии), при этом кластер 5.20.0.2  является RR-клиентом для скластера 5.20.0.1.  И так посмотрим настройки кластера 5.20.0.1:

R23:

![image](https://github.com/SalminKHV/OTUS/assets/130359715/2581c617-a6f3-4736-806a-ee3bfb68ea9e)



R24: 

![image](https://github.com/SalminKHV/OTUS/assets/130359715/e62f7370-fcc1-406a-a2bd-00b36c9365ba)

Теперь посмотрим настройки кластера 5.20.0.2:

R25:

![image](https://github.com/SalminKHV/OTUS/assets/130359715/0897cd41-eca4-4026-8a51-6f71d67dca8c)

R26: 

![image](https://github.com/SalminKHV/OTUS/assets/130359715/3164ce2e-e780-4828-9923-a72d82ea965c)



#### 4. Настройм офис С.-Петербург так, чтобы трафик до любого офиса распределялся по двум линкам одновременно.



![1](https://github.com/SalminKHV/OTUS/assets/130359715/f99bc4da-0580-4f9e-bd0d-ca4680a07579)



Распределение трафика дсотигается командой **bgp bestpath as-path multipath-relax**

![image](https://github.com/SalminKHV/OTUS/assets/130359715/73d776ad-3313-4ec2-b637-38bf7f26f3e2)



#### 5. Проверим IP связность сетей:

![image](https://github.com/SalminKHV/OTUS/assets/130359715/4a920a94-ca80-442b-af7e-225e39b27b67)



Внессем изменения в лабораторную работу:

Уйдем от кластеризации и назначим единственным RR-устройством в Триаде R23.

![image](https://github.com/SalminKHV/OTUS/assets/130359715/caed9b1f-6c36-4aac-81c2-ce1678aefd2b)























