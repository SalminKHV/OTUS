# BGP. Фильтрация

### Карта сети
![Карта сети](image.png)

#### Цель:

Настроить фильтрацию для офисе Москва
Настроить фильтрацию для офисе С.-Петербург

#### Описание/Пошаговая инструкция выполнения домашнего задания:

В этой самостоятельной работе мы ожидаем, что вы самостоятельно:

1. Настроим фильтрацию в офисе Москва так, чтобы не появилось транзитного трафика(As-path).
2. Настроим фильтрацию в офисе С.-Петербург так, чтобы не появилось транзитного трафика(Prefix-list).
3. Настроим провайдера Киторн так, чтобы в офис Москва отдавался только маршрут по умолчанию.
4. Настроим провайдера Ламас так, чтобы в офис Москва отдавался только маршрут по умолчанию и префикс офиса С.-Петербург.



#### 1. Настроим фильтрацию в офисе Москва так, чтобы не появилось транзитного трафика(As-path).

Для этого создадим as-path access-list, в котором укажем отбор AS-Path только маршрутов, оригинированных AS-1001(as, в которой располагаются роутеры R14 и R15). Затем применим правило разрешения прохождения трафика посредством route-map, и наконец применим это правило на исходящий к соседу(R22 Киторн) трафик.

![image](https://github.com/SalminKHV/OTUS/assets/130359715/48dc6251-2dda-4522-a9dc-a94579edbfc2)



Обратим внимание, что на R14 приходит только маршрут по умолчанию от R22 (провайдер Киторн, выполнив тем самым сразу **третье задание**), выполнили мы Это задание создав префикс лист, который пропускает только один маршрут (по умолчанию 0.0.0.0./0) и назначили этот лист на уходищий трафик к соседу R14:

![image](https://github.com/SalminKHV/OTUS/assets/130359715/1d02e38f-828e-4bd4-9bfd-b0735aabc352)



Тоже самое, что и на R 14 сделаем на R15 и попутно выполним **четвертое задание**(добавив префикс лист, как на R22)

![image-20231004230017299](https://github.com/SalminKHV/OTUS/assets/130359715/58d572e9-361a-4adb-95eb-93e8f0960733)

 R21:

![image](https://github.com/SalminKHV/OTUS/assets/130359715/5a4bcc73-a9f5-4167-a887-4479d2ade4c2)



Для выполнения третьего задания можно ничего не настраивать, но мы выполним защиту от дурака, добавив соответствующие префикс листы на исходящий трафик к обоим соседям: 

![image](https://github.com/SalminKHV/OTUS/assets/130359715/f61cc471-21f1-4362-b495-13ec2248050c)

Проблему с маршрутом по умолчанию в AS2045 удалось решить так:

 сначала на R16 увеличил Distance  для маршрута 0.0.0.0/0 c 5 до 250 

Командой:  

R16(config-router-af-topology)#summary-metric 0.0.0.0/0 distance 

![image](https://github.com/SalminKHV/OTUS/assets/130359715/61d520ca-e434-4635-ac43-bebe4750fb30)

а затем создал маршрут по умолчанию в NULL0 на R18, добавил трансляцию подсети 0.0.0.0/32 в трансляцию eigrp. Теперь мы имеем во всей сети маршрут по умолчанию на устройствах с distans metric 90.

IP - связность сетей присутствует:



![image](https://github.com/SalminKHV/OTUS/assets/130359715/0014898c-c9c6-41c5-87df-7cdc7ff118bc)
